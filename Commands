//install docker 
sudo apt-get update 
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common 
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - 
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" 
sudo apt-get -y install docker-ce docker-ce-cli containerd.io 

//run MongoDB Docker Image 
sudo docker run -d -p 27017:27107 -v ~/data:/data/db mongo

//run Application Docker Image
sudo docker build --tag app https://github.com/zainlol/lecture-devops-app.git 
sudo docker run -d -p 3000:3000 app 

// run Gitlab Docker Image 
export GITLAB_HOME=/srv 
sudo docker run --detach --hostname gitlab.example.com --publish 443:443 --publish 80:80 --publish 22:22 --name gitlab --restart always --volume $GITLAB_HOME/gitlab/config:/etc/gitlab --volume $GITLAB_HOME/gitlab/logs:/var/log/gitlab --volume $GITLAB_HOME/gitlab/data:/var/opt/gitlab  gitlab/gitlab-ce:latest 

//add repository of application to gitlab
cd lecture-devops-app
git init
git add --all
git config --global credential.helper store
git push --set-upstream https://gitlab.example.com/namespace/nonexistent-project.git master

//install snap and MicroK8s
git clone https://aur.archlinux.org/snapd.git
cd snapd
makepkg -si
sudo systemctl enable --now snapd.socket
sudo ln -s /var/lib/snapd/snap /snap
sudo snap install microk8s --classic
sudo microk8s enable dashboard
sudo microk8s enable registry

//add to user group
sudo usermod -a -G microk8s $USER
sudo chown -f -R $USER ~/.kube
su - $USER

// create token
token=$(microk8s kubectl -n kube-system get secret | grep default-token | cut -d " " -f1)
microk8s kubectl -n kube-system describe secret $token

//port forward
microk8s kubectl port-forward -n kube-system service/kubernetes-dashboard 10443:443
